# # provider "aws" {
# #   region = "ap-southeast-3"
# # }

# # resource "aws_instance" "my_ec2" {
# #   ami           = "ami-052ae27e2f9f3674f" # Amazon Linux 2 in Jakarta
# #   instance_type = "t3.micro"
# # }

# provider "aws" {
#   region = "ap-southeast-3"
# }

# resource "aws_key_pair" "dellkey" {
#   key_name = "dellkey"
#   public_key = file("~/.ssh/id_ed25519.pub")
# }

# resource "aws_security_group" "hello_api_sg" {
#   name        = "hello-api-sg"
#   description = "Allow inbound traffic on port 3000"

#   ingress {
#     from_port   = 22
#     to_port     = 22
#     protocol    = "tcp"
#     cidr_blocks = ["0.0.0.0/0"]
#   }
  
#   ingress {
#     from_port   = 3000
#     to_port     = 3000
#     protocol    = "tcp"
#     cidr_blocks = ["0.0.0.0/0"]
#   }

#   egress {
#     from_port   = 0
#     to_port     = 0
#     protocol    = "-1"
#     cidr_blocks = ["0.0.0.0/0"]
#   }
# }

# resource "aws_instance" "hello_ec2" {
#   ami           = "ami-052ae27e2f9f3674f"
#   instance_type = "t3.micro"
#   security_groups = [aws_security_group.hello_api_sg.name]
#   key_name = aws_key_pair.dellkey.key_name
#   # user_data = <<-EOF
#   #             #!/bin/bash
#   #             yum update -y
#   #             curl -sL https://rpm.nodesource.com/setup_22.x | bash -
#   #             yum install -y nodejs git
#   #             cd /home/ec2-user
#   #             git clone https://github.com/louispy/hello-api.git
#   #             cd hello-api
#   #             npm install
#   #             node index.js > app.log 2>&1 &
#   #             EOF
#   provisioner "remote-exec" {
#     inline = [
#       "sudo dnf update -y",
#       "curl -sL https://rpm.nodesource.com/setup_22.x | sudo bash -",
#       "sudo dnf install -y git nodejs"
#     ]

#     connection {
#       type        = "ssh"
#       user        = "ec2-user"
#       private_key = file("~/.ssh/id_ed25519")
#       host        = self.public_ip
#     }
#   }

#   tags = {
#     Name = "hello-api"
#   }
# }

